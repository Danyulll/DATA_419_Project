---
title: "Static Vis"
author: "Daniel Krasnov"
date: "2023-11-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
df <- read.csv(".\\data\\cirrhosis.csv",sep = ",",header = T)
head(df)
```

Cirrhosis results from prolonged liver damage, leading to extensive scarring, often due to conditions like hepatitis or chronic alcohol consumption. The data provided is sourced from a Mayo Clinic study on primary biliary cirrhosis (PBC) of the liver carried out from 1974 to 1984.

<https://aasldpubs.onlinelibrary.wiley.com/doi/epdf/10.1002/hep.1840100102>

| Variable Name | Type        | Description                                                                                                                                                                  | Units   |
|---------------|-------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|
| ID            | Integer     | Categorical                                                                                                                                                                  |         |
| N_Days        | Integer     | number of days between registration and the earlier of death, transplantation, or study analysis time in July 1986                                                           |         |
| Status        | Categorical | status of the patient C (censored), CL (censored due to liver tx), or D (death)                                                                                              |         |
| Drug          | Categorical | type of drug D-penicillamine or placebo                                                                                                                                      |         |
| Age           | Integer     | age                                                                                                                                                                          | days    |
| Sex           | Categorical | M (male) or F (female)                                                                                                                                                       |         |
| Ascites       | Categorical | presence of ascites N (No) or Y (Yes)                                                                                                                                        |         |
| Hepatomegaly  | Categorical | presence of hepatomegaly N (No) or Y (Yes)                                                                                                                                   |         |
| Spiders       | Categorical | presence of spiders N (No) or Y (Yes)                                                                                                                                        |         |
| Edema         | Categorical | presence of edema N (no edema and no diuretic therapy for edema), S (edema present without diuretics, or edema resolved by diuretics), or Y (edema despite diuretic therapy) |         |
| Bilirubin     | Continuous  | serum bilirubin                                                                                                                                                              | mg/dl   |
| Cholesterol   | Integer     | serum cholesterol                                                                                                                                                            | mg/dl   |
| Albumin       | Continuous  | albumin                                                                                                                                                                      | gm/dl   |
| Copper        | Integer     | urine copper                                                                                                                                                                 | ug/day  |
| Alk_Phos      | Continuous  | alkaline phosphatase                                                                                                                                                         | U/liter |
| SGOT          | Continuous  | SGOT                                                                                                                                                                         | U/ml    |
| Tryglicerides | Integer     | tryglicerides                                                                                                                                                                |         |
| Platelets     | Integer     | platelets per cubic                                                                                                                                                          | ml/1000 |
| Prothrombin   | Continuous  | prothrombin time                                                                                                                                                             | s       |
| Stage         | Categorical | histologic stage of disease (1, 2, 3, or 4)                                                                                                                                  |         |
|               |             |                                                                                                                                                                              |         |




```{r}
str(df)
```

```{r}
dim(df)
df <- na.omit(df)
dim(df)
```

```{r}
library(dplyr)
Status <- factor(df$Status)
df |> select(is.numeric) -> df
df <- cbind(Status,df)
df <- df[,-2]
df <- df[,-13]
# for (i in 1:ncol(df)) {
#   if(typeof(df[,i])=="character"){
#     df[,i] <- factor(df[,i])
#   }
# }
# df$Stage <- factor(df$Stage)
```

```{r}
library(klaR)
library(MLmetrics)
rda_out <- rda(Status~.,df)


ConfusionMatrix(predict(rda_out)$class, df$Status)

# Calculate and format results
post <- predict(rda_out)$posterior
class <- predict(rda_out)$class
y_pred <- as.numeric(predict(rda_out)$class)
y_true <- as.numeric(df$Status)
res <-
data.frame(
"Precision" = Precision(y_true, y_pred),
"Recall" = Recall(y_true, y_pred),
"F1_Score" = F1_Score(y_true, y_pred)
)
res
```

```{r}
factanal(df[,-1], factors = 2,rotation = "varimax") #TODo ask jeff if its bad to keep only 2 factors if we reject the null
```


```{r}
pca.out <- prcomp(df[,-1])
summary(pca.out)
```

```{r}
loadi <- round(pca.out$rotation[,1:2],4)
# loadi[abs(loadi)<0.001] <- NA
loadi
```
TODO try to interpret this...



Then do visualization


Could be fun to try pair plot visualization

